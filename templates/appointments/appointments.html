<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pullan Dental Clinic - Appointments</title>
    <link rel="stylesheet" href="../static/css/appointments.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <style>
        /* Status styling */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-active {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .status-completed {
            background-color: #e8f5e8;
            color: #388e3c;
        }
        
        .status-cancelled {
            background-color: #ffebee;
            color: #d32f2f;
        }
        
        /* Status filter buttons */
        .status-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            color: #666;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-filter-btn:hover {
            border-color: #2196f3;
            color: #2196f3;
        }
        
        .status-filter-btn.active {
            background: #2196f3;
            border-color: #2196f3;
            color: white;
        }
        
        .status-filter-btn .count {
            background: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .status-filter-btn.active .count {
            background: rgba(255,255,255,0.3);
        }

        /* Header actions container */
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Print report button */
        .print-report-button {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            position: relative;
            overflow: hidden;
        }

        .print-report-button:hover {
            background: linear-gradient(135deg, #45a049, #388e3c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .print-report-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .print-report-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .print-report-button:hover::before {
            left: 100%;
        }

        /* Add button styling update */
        .add-button {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .add-button:hover {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }
        
        /* Action buttons based on status */
        .action-complete {
            background-color: #4caf50;
            color: white;
        }
        
        .action-reactivate {
            background-color: #ff9800;
            color: white;
        }
        
        .action-complete:hover {
            background-color: #45a049;
        }
        
        .action-reactivate:hover {
            background-color: #f57c00;
        }
        
        /* Filter controls styling - IMPROVED */
        .filter-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
            border: 1px solid #e9ecef;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 180px;
        }

        .filter-group label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .filter-group input {
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .filter-group input:focus {
            outline: none;
            border-color: #2196f3;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
        }

        .helper-text {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
            font-style: italic;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        /* Filter button improvements */
        .filter-button {
            padding: 10px 18px;
            background-color: #2196f3;
            color: white;
            border: 1px solid #2196f3;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            height: fit-content;
            min-width: 120px;
            justify-content: center;
        }

        .filter-button:hover {
            background-color: #1976d2;
            border-color: #1976d2;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }

        .filter-button:active {
            transform: translateY(0);
        }

        .filter-button.clear-btn {
            background-color: #f44336;
            border-color: #f44336;
        }

        .filter-button.clear-btn:hover {
            background-color: #d32f2f;
            border-color: #d32f2f;
        }
        
        .appointments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .appointments-stats {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 14px;
            color: #666;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .notification-popup.show {
            transform: translateX(0);
        }

        .notification-popup.success {
            background-color: #4caf50;
        }

        .notification-popup.error {
            background-color: #f44336;
        }

        .notification-popup.info {
            background-color: #2196f3;
        }

        .notification-popup.warning {
            background-color: #ff9800;
        }

        /* Date validation styles */
        .form-group.invalid input {
            border-color: #f44336;
            background-color: #ffebee;
        }

        .form-group .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .form-group.invalid .error-message {
            display: block;
        }

        .form-group .helper-text {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
            font-style: italic;
        }

        /* Disabled submit button when invalid */
        .btn.submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Action Button Improvements */
        .action-button {
            margin: 0 2px;
            padding: 6px 8px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            min-width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .view-button {
            background-color: #2196f3;
            color: white;
        }

        .edit-button {
            background-color: #ff9800;
            color: white;
        }

        .delete-button {
            background-color: #f44336;
            color: white;
        }

        .view-button:hover {
            background-color: #1976d2;
        }

        .edit-button:hover {
            background-color: #f57c00;
        }

        .delete-button:hover {
            background-color: #d32f2f;
        }

        /* Text muted for completed appointments */
        .text-muted {
            color: #666;
            font-style: italic;
        }

        /* Improved table styling for status */
        .appointments-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .appointments-table th {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
        }

        .appointments-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .appointments-table tr:hover {
            background-color: #f8f9fa;
        }

        .stat-item .count {
            font-weight: bold;
            color: #333;
        }

        /* View Details Modal Styling */
        .appointment-details-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
        }

        .modal-header h2 {
            color: #2196f3;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .status-badge {
                font-size: 10px;
                padding: 2px 6px;
            }
            
            .status-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .status-filter-btn {
                justify-content: center;
                margin-bottom: 5px;
            }
            
            .appointments-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .header-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .print-report-button,
            .add-button {
                width: 100%;
                justify-content: center;
                padding: 14px 20px;
            }
            
            .appointments-stats {
                order: -1;
                justify-content: space-between;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .stat-item {
                flex: 1;
                min-width: 120px;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .filter-group {
                min-width: unset;
            }
            
            .filter-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .filter-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="brand">
                <h2>Pullan Dental</h2>
                <p>Clinic Management System</p>
            </div>
            <ul class="nav-menu">
                <!-- Admin Only - Backup & Restore -->
                {% if session.get('access_level') == 'admin' %}
                <li><a href="{{ url_for('backup_restore') }}"><i class="fas fa-database"></i> Backup & Restore</a></li>
                {% endif %}
                <li><a href="{{ url_for('dashboard') }}"><i class="fas fa-th-large"></i> Dashboard</a></li>
                <li><a href="{{ url_for('patients') }}"><i class="fas fa-user-injured"></i> Patients</a></li>
                <li class="active"><a href="{{ url_for('appointments') }}"><i class="fas fa-calendar-alt"></i> Appointments</a></li>
                <li><a href="{{ url_for('staff') }}"><i class="fas fa-user-md"></i> Staff</a></li>
                <li><a href="{{ url_for('inventory') }}"><i class="fas fa-box"></i> Inventory</a></li>
                <li><a href="{{ url_for('dental_charts') }}"><i class="fas fa-teeth"></i> Dental Charts</a></li>
                <!-- Admin Only - User Logs -->
                {% if session.get('access_level') == 'admin' %}
                <li><a href="{{ url_for('user_logs') }}"><i class="fas fa-history"></i> User Logs</a></li>
                {% endif %}
                <li><a href="{{ url_for('faq') }}"><i class="fas fa-question-circle"></i> FAQ</a></li>
                <li><a href="{{ url_for('settings') }}"><i class="fas fa-cog"></i> About</a></li>
            </ul>
            <div class="logout">
                <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="user-info">
                    <div class="user">
                        <span>{{ session.get('real_name', session.get('username', 'User')) }}</span>
                    </div>
                </div>
            </div>

            <div class="appointments-header">
                <div>
                    <h1>Appointments</h1>
                    <p class="date">{{ current_date }}</p>
                </div>
                <div class="appointments-stats">
                    <div class="stat-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Total: <span class="count">{{ total_count }}</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock" style="color: #1976d2;"></i>
                        <span>Active: <span class="count">{{ active_count }}</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-check-circle" style="color: #388e3c;"></i>
                        <span>Completed: <span class="count">{{ completed_count }}</span></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-times-circle" style="color: #d32f2f;"></i>
                        <span>Cancelled: <span class="count">{{ cancelled_count }}</span></span>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="print-report-button" id="printAppointmentsReport" title="Print appointments report">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                    <button class="add-button" id="openAddAppointmentModal">
                        <i class="fas fa-plus"></i> Schedule Appointment
                    </button>
                </div>
            </div>

            <!-- Status Filter Buttons -->
            <div class="status-filters">
                <a href="{{ url_for('appointments', status='all') }}" 
                   class="status-filter-btn {{ 'active' if status_filter == 'all' else '' }}">
                    <i class="fas fa-list"></i>
                    All Appointments
                    <span class="count">{{ total_count }}</span>
                </a>
                <a href="{{ url_for('appointments', status='active') }}" 
                   class="status-filter-btn {{ 'active' if status_filter == 'active' else '' }}">
                    <i class="fas fa-clock"></i>
                    Active
                    <span class="count">{{ active_count }}</span>
                </a>
                <a href="{{ url_for('appointments', status='completed') }}" 
                   class="status-filter-btn {{ 'active' if status_filter == 'completed' else '' }}">
                    <i class="fas fa-check-circle"></i>
                    Completed
                    <span class="count">{{ completed_count }}</span>
                </a>
                <a href="{{ url_for('appointments', status='cancelled') }}" 
                   class="status-filter-btn {{ 'active' if status_filter == 'cancelled' else '' }}">
                    <i class="fas fa-times-circle"></i>
                    Cancelled
                    <span class="count">{{ cancelled_count }}</span>
                </a>
            </div>

            <div class="page-actions">
                <a href="{{ url_for('rescheduled_appointments') }}" class="view-rescheduled-button">
                    <i class="fas fa-calendar-check"></i> View Rescheduled Appointments
                </a>
            </div>

            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="dateFilter">Date:</label>
                    <input type="date" id="dateFilter" value="{{ today_date }}">
                    <div class="helper-text">Select a specific date to filter appointments</div>
                </div>
                <div class="filter-group">
                    <label for="patientFilter">Patient:</label>
                    <input type="text" id="patientFilter" placeholder="Filter by patient name...">
                    <div class="helper-text">Type patient name to search</div>
                </div>
                <div class="filter-actions">
                    <button id="applyFilters" class="filter-button">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <button id="clearFilters" class="filter-button clear-btn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
            </div>

            <div class="appointments-table">
                <table id="appointmentsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Patient Name</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appointment in appointments %}
                        <tr>
                            <td>{{ appointment.id }}</td>
                            <td>{{ appointment.patient_name }}</td>
                            <td>{{ appointment.date }}</td>
                            <td>{{ appointment.time }}</td>
                            <td>
                                <span class="status-badge {{ appointment.status_class }}">
                                    {% if appointment.status == 'active' %}
                                        <i class="fas fa-clock"></i> Active
                                    {% elif appointment.status == 'completed' %}
                                        <i class="fas fa-check-circle"></i> Completed
                                    {% elif appointment.status == 'cancelled' %}
                                        <i class="fas fa-times-circle"></i> Cancelled
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <button class="action-button view-button" 
                                        data-id="{{ appointment.raw_id }}" 
                                        data-patient="{{ appointment.patient_name }}"
                                        data-date="{{ appointment.date }}"
                                        data-time="{{ appointment.time }}"
                                        data-status="{{ appointment.status }}"
                                        title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                
                                {% if appointment.status == 'active' %}
                                    <!-- Active appointment actions -->
                                    <button class="action-button edit-button" 
                                            data-id="{{ appointment.raw_id }}" 
                                            title="Reschedule Appointment">
                                        <i class="fas fa-calendar-alt"></i>
                                    </button>
                                    <button class="action-button action-complete" 
                                            data-id="{{ appointment.raw_id }}" 
                                            title="Mark as Completed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="action-button delete-button" 
                                            data-id="{{ appointment.raw_id }}" 
                                            title="Cancel Appointment">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    
                                {% elif appointment.status == 'cancelled' %}
                                    <!-- Cancelled appointment actions -->
                                    <button class="action-button action-reactivate" 
                                            data-id="{{ appointment.raw_id }}" 
                                            title="Reactivate Appointment">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                    
                                {% elif appointment.status == 'completed' %}
                                    <!-- Completed appointment actions -->
                                    <span class="text-muted">
                                        <i class="fas fa-check-circle"></i> Completed
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <button>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="active">1</button>
                <button>2</button>
                <button>3</button>
                <button>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Add Appointment Modal -->
    <div id="addAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Schedule New Appointment</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="addAppointmentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient">Patient*</label>
                            <select id="patient" name="patient_id" required>
                                <option value="">Select Patient</option>
                                {% for patient in all_patients %}
                                <option value="{{ patient.patId }}">{{ patient.patname }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <button type="button" id="selectExistingPatient" class="btn secondary-btn">
                                <i class="fas fa-user-injured"></i> Select Existing
                            </button>
                            <button type="button" id="addNewPatient" class="btn secondary-btn">
                                <i class="fas fa-user-plus"></i> Add New
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" id="appointmentDateGroup">
                            <label for="appointmentDate">Date*</label>
                            <input type="date" id="appointmentDate" name="date" required>
                            <div class="helper-text">Only future dates are allowed</div>
                            <div class="error-message">Please select a future date. Past dates are not allowed.</div>
                        </div>
                        <div class="form-group">
                            <label for="appointmentTime">Time*</label>
                            <input type="time" id="appointmentTime" name="time" required>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="notes">Notes</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn cancel-btn" id="cancelAddAppointment">Cancel</button>
                        <button type="submit" class="btn submit-btn" id="scheduleAppointmentBtn">Schedule Appointment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Reschedule Appointment Modal -->
    <div id="rescheduleAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reschedule Appointment</h2>
                <span class="close-modal" id="closeRescheduleModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="rescheduleAppointmentForm">
                    <input type="hidden" id="appointmentId" name="appointment_id">
                    
                    <div class="form-group full-width">
                        <label>Current Details:</label>
                        <div class="current-details">
                            <p><strong>Patient:</strong> <span id="currentPatient"></span></p>
                            <p><strong>Date:</strong> <span id="currentDate"></span></p>
                            <p><strong>Time:</strong> <span id="currentTime"></span></p>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" id="newAppointmentDateGroup">
                            <label for="newAppointmentDate">New Date*</label>
                            <input type="date" id="newAppointmentDate" name="date" required>
                            <div class="helper-text">Only future dates are allowed</div>
                            <div class="error-message">Please select a future date. Past dates are not allowed.</div>
                        </div>
                        <div class="form-group">
                            <label for="newAppointmentTime">New Time*</label>
                            <input type="time" id="newAppointmentTime" name="time" required>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="rescheduleReason">Reason for Rescheduling</label>
                        <textarea id="rescheduleReason" name="reason" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn cancel-btn" id="cancelReschedule">Cancel</button>
                        <button type="submit" class="btn submit-btn" id="saveRescheduleBtn">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Appointment Details Modal -->
    <div id="viewAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-alt"></i> Appointment Details</h2>
                <span class="close-modal" id="closeViewModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="appointment-details-info">
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-hashtag"></i> Appointment ID:
                        </span>
                        <span class="detail-value" id="viewAppointmentId">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-user-injured"></i> Patient Name:
                        </span>
                        <span class="detail-value" id="viewPatientName">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-phone"></i> Patient Contact:
                        </span>
                        <span class="detail-value" id="viewPatientContact">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-calendar"></i> Date:
                        </span>
                        <span class="detail-value" id="viewAppointmentDate">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-clock"></i> Time:
                        </span>
                        <span class="detail-value" id="viewAppointmentTime">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-info-circle"></i> Status:
                        </span>
                        <span class="detail-value">
                            <span id="viewAppointmentStatus" class="status-indicator">-</span>
                        </span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-sticky-note"></i> Notes:
                        </span>
                        <span class="detail-value" id="viewAppointmentNotes">No notes available</span>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn cancel-btn" id="closeViewDetails">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('🔄 Loading appointments page...');
        
        // Get patient contact info for view details
        const patientContacts = {};
        {% for patient in all_patients %}
        patientContacts['{{ patient.patname }}'] = '{{ patient.patcontact or "N/A" }}';
        {% endfor %}
        
        // Date validation and parsing functions
        function getTodayString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Function to parse date string and normalize format
        function parseAndNormalizeDate(dateStr) {
            if (!dateStr) return null;
            
            // Remove extra spaces and normalize
            const cleanDate = dateStr.trim();
            
            // Try different date formats that might be in the table
            const formats = [
                // ISO format YYYY-MM-DD
                /^(\d{4})-(\d{1,2})-(\d{1,2})$/,
                // MM/DD/YYYY format
                /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
                // DD/MM/YYYY format
                /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
                // MM-DD-YYYY format
                /^(\d{1,2})-(\d{1,2})-(\d{4})$/,
                // DD-MM-YYYY format
                /^(\d{1,2})-(\d{1,2})-(\d{4})$/,
                // Month DD, YYYY format (e.g., "January 15, 2024")
                /^(\w+)\s+(\d{1,2}),\s+(\d{4})$/
            ];
            
            // Check ISO format first (YYYY-MM-DD)
            if (formats[0].test(cleanDate)) {
                return cleanDate; // Already in correct format
            }
            
            // Check MM/DD/YYYY or MM-DD-YYYY
            let match = cleanDate.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
            if (match) {
                const month = match[1].padStart(2, '0');
                const day = match[2].padStart(2, '0');
                const year = match[3];
                return `${year}-${month}-${day}`;
            }
            
            // Check for month name format
            const monthNames = {
                'january': '01', 'february': '02', 'march': '03', 'april': '04',
                'may': '05', 'june': '06', 'july': '07', 'august': '08',
                'september': '09', 'october': '10', 'november': '11', 'december': '12',
                'jan': '01', 'feb': '02', 'mar': '03', 'apr': '04',
                'jun': '06', 'jul': '07', 'aug': '08', 'sep': '09',
                'oct': '10', 'nov': '11', 'dec': '12'
            };
            
            match = cleanDate.match(/^(\w+)\s+(\d{1,2}),\s+(\d{4})$/);
            if (match) {
                const monthName = match[1].toLowerCase();
                const day = match[2].padStart(2, '0');
                const year = match[3];
                const monthNum = monthNames[monthName];
                if (monthNum) {
                    return `${year}-${monthNum}-${day}`;
                }
            }
            
            // If no format matches, try to parse with Date constructor
            try {
                const date = new Date(cleanDate);
                if (!isNaN(date.getTime())) {
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                }
            } catch (e) {
                console.warn('Could not parse date:', cleanDate);
            }
            
            return null;
        }
        
        function validateDate(dateInput, formGroup, submitButton) {
            const selectedDate = dateInput.value;
            const today = getTodayString();
            
            if (selectedDate && selectedDate < today) {
                formGroup.classList.add('invalid');
                if (submitButton) {
                    submitButton.disabled = true;
                }
                return false;
            } else {
                formGroup.classList.remove('invalid');
                if (submitButton) {
                    submitButton.disabled = false;
                }
                return true;
            }
        }
        
        // Initialize date validation
        function initializeDateValidation() {
            const today = getTodayString();
            
            // Add appointment modal
            const appointmentDate = document.getElementById('appointmentDate');
            const appointmentDateGroup = document.getElementById('appointmentDateGroup');
            const scheduleBtn = document.getElementById('scheduleAppointmentBtn');
            
            appointmentDate.setAttribute('min', today);
            appointmentDate.value = today;
            
            appointmentDate.addEventListener('change', function() {
                validateDate(this, appointmentDateGroup, scheduleBtn);
            });
            
            // Reschedule appointment modal
            const newAppointmentDate = document.getElementById('newAppointmentDate');
            const newAppointmentDateGroup = document.getElementById('newAppointmentDateGroup');
            const saveRescheduleBtn = document.getElementById('saveRescheduleBtn');
            
            newAppointmentDate.setAttribute('min', today);
            
            newAppointmentDate.addEventListener('change', function() {
                validateDate(this, newAppointmentDateGroup, saveRescheduleBtn);
            });
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeDateValidation();
        });
        
        // View Appointment Details Modal functionality
        const viewModal = document.getElementById('viewAppointmentModal');
        const closeViewModalBtn = document.getElementById('closeViewModal');
        const closeViewDetailsBtn = document.getElementById('closeViewDetails');

        // Setup view buttons
        document.querySelectorAll('.view-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                const appointmentId = this.getAttribute('data-id');
                const patientName = this.getAttribute('data-patient');
                const appointmentDate = this.getAttribute('data-date');
                const appointmentTime = this.getAttribute('data-time');
                const status = this.getAttribute('data-status');
                
                // Populate modal fields
                document.getElementById('viewAppointmentId').textContent = `APT-${String(appointmentId).padStart(3, '0')}`;
                document.getElementById('viewPatientName').textContent = patientName;
                document.getElementById('viewPatientContact').textContent = patientContacts[patientName] || 'N/A';
                document.getElementById('viewAppointmentDate').textContent = appointmentDate;
                document.getElementById('viewAppointmentTime').textContent = appointmentTime;
                document.getElementById('viewAppointmentNotes').textContent = 'No notes available';
                
                // Set status with appropriate styling
                const statusElement = document.getElementById('viewAppointmentStatus');
                statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
                statusElement.className = `status-indicator status-${status}`;
                
                // Show modal
                viewModal.style.display = 'block';
                document.body.classList.add('modal-open');
            });
        });

        function closeViewModal() {
            viewModal.style.display = 'none';
            document.body.classList.remove('modal-open');
        }

        closeViewModalBtn.addEventListener('click', closeViewModal);
        closeViewDetailsBtn.addEventListener('click', closeViewModal);

        window.addEventListener('click', function(event) {
            if (event.target === viewModal) {
                closeViewModal();
            }
        });
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const searchValue = this.value.toLowerCase();
            const table = document.getElementById('appointmentsTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 1; i < rows.length; i++) {
                let found = false;
                const cells = rows[i].getElementsByTagName('td');
                
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent.toLowerCase();
                    if (cellText.indexOf(searchValue) > -1) {
                        found = true;
                        break;
                    }
                }
                
                rows[i].style.display = found ? '' : 'none';
            }
        });
        
        // Appointment cancellation functionality
        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const appointmentId = this.getAttribute('data-id');
                const row = this.closest('tr');
                const patientName = row.cells[1].textContent.trim();
                
                if(confirm(`Are you sure you want to cancel the appointment for ${patientName}?`)) {
                    this.style.opacity = '0.5';
                    this.disabled = true;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    
                    fetch(`/cancel_appointment/${appointmentId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        this.style.opacity = '1';
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-times"></i>';
                        
                        if (data.success === true) {
                            showNotification('Appointment cancelled successfully!', 'success');
                            
                            const statusCell = row.cells[4];
                            statusCell.innerHTML = '<span class="status-badge status-cancelled"><i class="fas fa-times-circle"></i> Cancelled</span>';
                            
                            const actionsCell = row.cells[5];
                            const viewButton = actionsCell.querySelector('.view-button');
                            const viewButtonClone = viewButton ? viewButton.cloneNode(true) : null;
                            
                            actionsCell.innerHTML = '';
                            
                            if (viewButtonClone) {
                                actionsCell.appendChild(viewButtonClone);
                                // Re-add event listener to cloned view button
                                viewButtonClone.addEventListener('click', function(e) {
                                    e.preventDefault();
                                    const appointmentId = this.getAttribute('data-id');
                                    const patientName = this.getAttribute('data-patient');
                                    const appointmentDate = this.getAttribute('data-date');
                                    const appointmentTime = this.getAttribute('data-time');
                                    const status = 'cancelled';
                                    
                                    document.getElementById('viewAppointmentId').textContent = `APT-${String(appointmentId).padStart(3, '0')}`;
                                    document.getElementById('viewPatientName').textContent = patientName;
                                    document.getElementById('viewPatientContact').textContent = patientContacts[patientName] || 'N/A';
                                    document.getElementById('viewAppointmentDate').textContent = appointmentDate;
                                    document.getElementById('viewAppointmentTime').textContent = appointmentTime;
                                    document.getElementById('viewAppointmentNotes').textContent = 'No notes available';
                                    
                                    const statusElement = document.getElementById('viewAppointmentStatus');
                                    statusElement.textContent = 'Cancelled';
                                    statusElement.className = 'status-indicator status-cancelled';
                                    
                                    viewModal.style.display = 'block';
                                    document.body.classList.add('modal-open');
                                });
                            }
                            
                            const reactivateBtn = document.createElement('button');
                            reactivateBtn.className = 'action-button action-reactivate';
                            reactivateBtn.setAttribute('data-id', appointmentId);
                            reactivateBtn.title = 'Reactivate Appointment';
                            reactivateBtn.innerHTML = '<i class="fas fa-undo"></i>';
                            reactivateBtn.addEventListener('click', function() {
                                reactivateAppointment(appointmentId, row);
                            });
                            
                            actionsCell.appendChild(reactivateBtn);
                            
                        } else {
                            showNotification(data.error || 'Failed to cancel appointment', 'error');
                        }
                    })
                    .catch(error => {
                        this.style.opacity = '1';
                        this.disabled = false;
                        this.innerHTML = '<i class="fas fa-times"></i>';
                        showNotification('Failed to cancel appointment: ' + error.message, 'error');
                    });
                }
            });
        });

        // Complete appointment functionality
        document.querySelectorAll('.action-complete').forEach(button => {
            button.addEventListener('click', function() {
                const appointmentId = this.getAttribute('data-id');
                if(confirm(`Mark this appointment as completed?`)) {
                    fetch(`/complete_appointment/${appointmentId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showNotification('Appointment marked as completed', 'success');
                            setTimeout(() => {
                                window.location.reload();
                            }, 1000);
                        } else {
                            showNotification('Error completing appointment: ' + data.error, 'error');
                        }
                    })
                    .catch(error => {
                        showNotification('An error occurred while completing the appointment.', 'error');
                    });
                }
            });
        });
        
        // Reactivate appointment functionality
        function reactivateAppointment(appointmentId, row) {
            const patientName = row.cells[1].textContent.trim();
            
            if(confirm(`Reactivate the appointment for ${patientName}?`)) {
                fetch(`/reactivate_appointment/${appointmentId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showNotification('Appointment reactivated successfully!', 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    } else {
                        showNotification(data.error || 'Failed to reactivate appointment', 'error');
                    }
                })
                .catch(error => {
                    showNotification('Failed to reactivate appointment: ' + error.message, 'error');
                });
            }
        }
        
        // Setup existing reactivate buttons
        document.querySelectorAll('.action-reactivate').forEach(button => {
            button.addEventListener('click', function() {
                const appointmentId = this.getAttribute('data-id');
                const row = this.closest('tr');
                reactivateAppointment(appointmentId, row);
            });
        });
        
        // IMPROVED Filter functionality with proper date handling
        document.getElementById('applyFilters').addEventListener('click', function() {
            const dateFilter = document.getElementById('dateFilter').value;
            const patientFilter = document.getElementById('patientFilter').value.toLowerCase().trim();
            
            const table = document.getElementById('appointmentsTable');
            const rows = table.getElementsByTagName('tr');
            let visibleCount = 0;
            
            console.log('Applying filters - Date:', dateFilter, 'Patient:', patientFilter);
            
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const dateText = cells[2].textContent.trim();
                const patientText = cells[1].textContent.toLowerCase().trim();
                
                let dateMatch = true;
                let patientMatch = true;
                
                // Date filtering with proper parsing
                if (dateFilter) {
                    const normalizedTableDate = parseAndNormalizeDate(dateText);
                    console.log(`Row ${i}: Original date: "${dateText}", Normalized: "${normalizedTableDate}", Filter: "${dateFilter}"`);
                    
                    if (normalizedTableDate) {
                        dateMatch = (normalizedTableDate === dateFilter);
                    } else {
                        // Fallback to string comparison if parsing fails
                        dateMatch = dateText.toLowerCase().includes(dateFilter.toLowerCase());
                    }
                } else {
                    dateMatch = true; // Show all if no date filter
                }
                
                // Patient filtering
                if (patientFilter) {
                    patientMatch = patientText.includes(patientFilter);
                } else {
                    patientMatch = true; // Show all if no patient filter
                }
                
                const shouldShow = dateMatch && patientMatch;
                rows[i].style.display = shouldShow ? '' : 'none';
                
                if (shouldShow) {
                    visibleCount++;
                }
            }
            
            const filterMessage = [];
            if (dateFilter) filterMessage.push(`date: ${dateFilter}`);
            if (patientFilter) filterMessage.push(`patient: "${patientFilter}"`);
            
            const filterText = filterMessage.length > 0 ? ` (${filterMessage.join(', ')})` : '';
            showNotification(`Filters applied${filterText}. ${visibleCount} appointments found.`, 'info');
        });

        // Clear filters functionality
        document.getElementById('clearFilters').addEventListener('click', function() {
            document.getElementById('dateFilter').value = '';
            document.getElementById('patientFilter').value = '';
            
            const table = document.getElementById('appointmentsTable');
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 1; i < rows.length; i++) {
                rows[i].style.display = '';
            }
            
            showNotification('Filters cleared', 'info');
        });
        
        // Print functionality
        const printButton = document.getElementById('printAppointmentsReport');
        if (printButton) {
            printButton.addEventListener('click', function() {
                const urlParams = new URLSearchParams(window.location.search);
                const currentStatus = urlParams.get('status') || 'all';
                const dateFilter = document.getElementById('dateFilter').value;
                const patientFilter = document.getElementById('patientFilter').value;
                
                const printUrl = new URL('/print_appointments_report', window.location.origin);
                printUrl.searchParams.append('status', currentStatus);
                
                if (dateFilter) {
                    printUrl.searchParams.append('date', dateFilter);
                }
                
                if (patientFilter.trim()) {
                    printUrl.searchParams.append('patient', patientFilter.trim());
                }
                
                this.classList.add('loading');
                this.disabled = true;
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                
                const printWindow = window.open(printUrl.toString(), '_blank');
                
                if (!printWindow) {
                    showNotification('Print window blocked. Please allow popups or try again.', 'warning');
                    window.location.href = printUrl.toString();
                } else {
                    showNotification('Print report generated successfully!', 'success');
                    
                    setTimeout(() => {
                        this.classList.remove('loading');
                        this.disabled = false;
                        this.innerHTML = originalText;
                    }, 1500);
                }
            });
        }
        
        // Modal functionality
        const modal = document.getElementById('addAppointmentModal');
        const openModalBtn = document.getElementById('openAddAppointmentModal');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelBtn = document.getElementById('cancelAddAppointment');
        
        openModalBtn.addEventListener('click', function() {
            modal.style.display = 'block';
            document.body.classList.add('modal-open');
            
            const today = getTodayString();
            const appointmentDate = document.getElementById('appointmentDate');
            appointmentDate.value = today;
            
            const appointmentDateGroup = document.getElementById('appointmentDateGroup');
            const scheduleBtn = document.getElementById('scheduleAppointmentBtn');
            validateDate(appointmentDate, appointmentDateGroup, scheduleBtn);
        });
        
        function closeModal() {
            modal.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.getElementById('addAppointmentForm').reset();
            
            const appointmentDateGroup = document.getElementById('appointmentDateGroup');
            appointmentDateGroup.classList.remove('invalid');
            const scheduleBtn = document.getElementById('scheduleAppointmentBtn');
            scheduleBtn.disabled = false;
        }
        
        closeModalBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                closeModal();
            }
        });
        
        document.getElementById('selectExistingPatient').addEventListener('click', function() {
            document.getElementById('patient').focus();
        });
        
        document.getElementById('addNewPatient').addEventListener('click', function() {
            window.location.href = "{{ url_for('patients') }}?show_add_modal=true";
        });
        
        // Add appointment form submission
        document.getElementById('addAppointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/add_appointment', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal();
                    showNotification('Appointment scheduled successfully', 'success');
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showNotification('Error scheduling appointment: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showNotification('An error occurred while scheduling the appointment.', 'error');
            });
        });
        
        // Reschedule modal functionality
        const rescheduleModal = document.getElementById('rescheduleAppointmentModal');
        const closeRescheduleModalBtn = document.getElementById('closeRescheduleModal');
        const cancelRescheduleBtn = document.getElementById('cancelReschedule');

        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const appointmentId = this.getAttribute('data-id');
                const row = this.closest('tr');
                const patient = row.cells[1].textContent;
                const date = row.cells[2].textContent;
                const time = row.cells[3].textContent;
                
                document.getElementById('appointmentId').value = appointmentId;
                document.getElementById('currentPatient').textContent = patient;
                document.getElementById('currentDate').textContent = date;
                document.getElementById('currentTime').textContent = time;
                
                const today = getTodayString();
                const newAppointmentDate = document.getElementById('newAppointmentDate');
                newAppointmentDate.value = today;
                
                let timeValue = '';
                if (time.match(/^\d{1,2}:\d{2}/)) {
                    timeValue = time.trim();
                }
                document.getElementById('newAppointmentTime').value = timeValue;
                document.getElementById('rescheduleReason').value = '';
                
                rescheduleModal.style.display = 'block';
                document.body.classList.add('modal-open');
            });
        });

        function closeRescheduleModal() {
            rescheduleModal.style.display = 'none';
            document.body.classList.remove('modal-open');
            document.getElementById('rescheduleAppointmentForm').reset();
        }

        closeRescheduleModalBtn.addEventListener('click', closeRescheduleModal);
        cancelRescheduleBtn.addEventListener('click', closeRescheduleModal);

        window.addEventListener('click', function(event) {
            if (event.target === rescheduleModal) {
                closeRescheduleModal();
            }
        });

        // Reschedule form submission
        document.getElementById('rescheduleAppointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/reschedule_appointment', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeRescheduleModal();
                    showNotification('Appointment rescheduled successfully', 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showNotification('Error rescheduling appointment: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showNotification('An error occurred while rescheduling the appointment.', 'error');
            });
        });

        // Notification function
        function showNotification(message, type = 'info') {
            const existingNotifications = document.querySelectorAll('.notification-popup');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            const notification = document.createElement('div');
            notification.className = `notification-popup ${type}`;
            
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i> ';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i> ';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i> ';
                    break;
                case 'info':
                    icon = '<i class="fas fa-info-circle"></i> ';
                    break;
            }
            
            notification.innerHTML = icon + message;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 350px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                ${type === 'success' ? 'background-color: #4caf50;' : ''}
                ${type === 'error' ? 'background-color: #f44336;' : ''}
                ${type === 'warning' ? 'background-color: #ff9800;' : ''}
                ${type === 'info' ? 'background-color: #2196f3;' : ''}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        console.log('✅ Appointments page loaded successfully with improved date filtering!');
    </script>
</body>
</html>